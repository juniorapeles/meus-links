<!-- ...mesmo conteúdo até a função renderizarTabela... -->

<script>
  const meses = [
    "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
    "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
  ];
  const anoAtual = new Date().getFullYear();
  let mesAtual = new Date().getMonth();

  const dados = Array(12).fill(null).map(() => []);

  function atualizarTitulo() {
    document.getElementById("mesTitulo").innerText = `${meses[mesAtual]} ${anoAtual}`;
  }

  function renderizarTabela() {
    const corpo = document.getElementById("tabelaCorpo");
    corpo.innerHTML = "";

    const tipos = ["renda", "despesa-fixa", "despesa-variavel"];
    const totais = {
      "renda": 0,
      "despesa-fixa": 0,
      "despesa-variavel": 0
    };

    dados[mesAtual].forEach((linha, index) => {
      const tr = document.createElement("tr");
      tr.className = linha.tipo;

      tr.innerHTML = `
        <td>${formatarCategoria(linha.tipo)}</td>
        <td contenteditable="true"
            oninput="atualizarDescricao(${mesAtual}, ${index}, this.innerText)">
            ${linha.descricao || ""}
        </td>
        <td contenteditable="true"
            onblur="atualizarValor(${mesAtual}, ${index}, this.innerText)">
            ${linha.valor || ""}
        </td>
        <td class="btn-add">
          <button class="btn btn-outline-danger btn-sm" onclick="removerLinha(${index})">−</button>
        </td>
      `;
      corpo.appendChild(tr);

      const valorNum = parseFloat(linha.valor.replace(",", "."));
      if (!isNaN(valorNum)) {
        totais[linha.tipo] += valorNum;
      }
    });

    // Totais por categoria
    tipos.forEach(tipo => {
      const trTotal = document.createElement("tr");
      trTotal.className = "grupo-total";
      trTotal.innerHTML = `
        <td colspan="2">Total de ${formatarCategoria(tipo)}</td>
        <td colspan="2">R$ ${totais[tipo].toFixed(2)}</td>
      `;
      corpo.appendChild(trTotal);
    });

    // Total final (Renda - Despesas)
    const totalFinal = totais["renda"] - (totais["despesa-fixa"] + totais["despesa-variavel"]);
    const trFinalResultado = document.createElement("tr");
    trFinalResultado.className = "grupo-total";
    trFinalResultado.innerHTML = `
      <td colspan="2">Saldo Final</td>
      <td colspan="2">R$ ${totalFinal.toFixed(2)}</td>
    `;
    corpo.appendChild(trFinalResultado);

    // Linha final para mobile (clique para adicionar)
    const trFinal = document.createElement("tr");
    trFinal.innerHTML = `
      <td colspan="4" class="text-muted fst-italic text-center" onclick="adicionarLinha('renda')">
        Toque aqui para adicionar uma nova entrada
      </td>
    `;
    corpo.appendChild(trFinal);
  }

  function formatarCategoria(tipo) {
    switch (tipo) {
      case "renda": return "Renda";
      case "despesa-fixa": return "Despesa Fixa";
      case "despesa-variavel": return "Despesa Variável";
      default: return "";
    }
  }

  function adicionarLinha(tipo) {
    dados[mesAtual].push({
      tipo: tipo,
      descricao: "",
      valor: ""
    });
    renderizarTabela();
  }

  function removerLinha(index) {
    dados[mesAtual].splice(index, 1);
    renderizarTabela();
  }

  function mudarMes(direcao) {
    mesAtual = (mesAtual + direcao + 12) % 12;
    atualizarTitulo();
    renderizarTabela();
  }

  function atualizarDescricao(mes, index, valor) {
    dados[mes][index].descricao = valor;
  }

  function atualizarValor(mes, index, valor) {
    dados[mes][index].valor = valor;
    renderizarTabela();
  }

  atualizarTitulo();
  renderizarTabela();
</script>